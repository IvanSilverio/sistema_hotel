from selenium import webdriver
from selenium.webdriver.common.by import By
from webdriver_manager.chrome import ChromeDriverManager
from selenium.webdriver.chrome.service import Service
import time

# Configuração do WebDriver
service = Service(ChromeDriverManager().install())
driver = webdriver.Chrome(service=service)

# URL do arquivo HTML local
url = "http://127.0.0.1:5500/funcionario/index.html"
driver.get(url)

# Função para testar o CRUD de Funcionários
def test_funcionario_crud():
    # Adicionar Funcionário
    driver.find_element(By.ID, "nome").send_keys("Carlos Silva")
    driver.find_element(By.ID, "cpf").send_keys("12345678900")
    driver.find_element(By.ID, "cargo").send_keys("Gerente")
    driver.find_element(By.ID, "telefone").send_keys("(11) 91234-5678")
    driver.find_element(By.CSS_SELECTOR, "#funcionarioForm button").click()
    time.sleep(1)

    # Verificar se o funcionário foi adicionado
    funcionario_nome = driver.find_element(By.XPATH, "//table[@id='funcionarioTable']//tr[2]/td[1]").text
    assert funcionario_nome == "Carlos Silva", "Erro ao adicionar funcionário"

    # Editar Funcionário
    driver.find_element(By.XPATH, "//table[@id='funcionarioTable']//tr[2]//button[text()='Editar']").click()
    driver.find_element(By.ID, "nome").clear()
    driver.find_element(By.ID, "nome").send_keys("Carlos Souza")
    driver.find_element(By.CSS_SELECTOR, "#funcionarioForm button").click()
    time.sleep(1)

    # Verificar se o nome do funcionário foi editado
    funcionario_nome_editado = driver.find_element(By.XPATH, "//table[@id='funcionarioTable']//tr[2]/td[1]").text
    assert funcionario_nome_editado == "Carlos Souza", "Erro ao editar funcionário"

    # Excluir Funcionário
    driver.find_element(By.XPATH, "//table[@id='funcionarioTable']//tr[2]//button[text()='Excluir']").click()
    time.sleep(1)

    # Verificar se a tabela está vazia novamente
    linhas_funcionarios = driver.find_elements(By.XPATH, "//table[@id='funcionarioTable']//tr")
    assert len(linhas_funcionarios) == 1, "Erro ao excluir funcionário"

# Executar os testes
try:
    print("Testando CRUD de Funcionários...")
    test_funcionario_crud()
    print("CRUD de Funcionários testado com sucesso.")
finally:
    driver.quit()
